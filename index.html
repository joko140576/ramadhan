<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Ramadhan Checklist</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Font Awesome -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">


<style>
body {
background: linear-gradient(180deg,#e8f5e9,#ffffff);
font-family: 'Segoe UI', sans-serif;
}
.header {
background: linear-gradient(135deg,#0f9d58,#198754);
color: white;
padding: 20px;
border-radius: 0 0 20px 20px;
text-align: center;
}
.card {
border-radius: 16px;
box-shadow: 0 8px 20px rgba(0,0,0,.08);
}
.form-check-input {
width: 1.3em;
height: 1.3em;
}


/* Tombol normal */
.btn-save {
background: linear-gradient(135deg, #0f9d58, #198754);
color: white;
border-radius: 30px;
padding: 12px;
font-size: 1.1rem;
border: none;
transition: 0.3s;
}

/* Hover */
.btn-save:hover {
background: linear-gradient(135deg, #0c7c46, #146c43);
color: white;
}

/* Saat loading / disabled */
.btn-save:disabled {
background: linear-gradient(135deg, #16a085, #27ae60);
color: white;
opacity: 1; /* HILANGKAN efek pucat */
cursor: not-allowed;
}

.spinner-border {
color: white;
}

</style>
</head>

<body>

<div class="header mb-4">
<h4 class="fw-bold">
<i class="fas fa-moon"></i> Ramadhan Checklist
</h4>
<small>Catat amalan harian</small>
</div>

<div class="container pb-4">

<!-- NAMA -->
<div class="mb-3">
<label class="fw-semibold">
<i class="fas fa-user"></i> Nama
</label>
<select class="form-select" id="nama" name="nama" required>
<option value="">-- Pilih Nama --</option>
<option value="Mama">Mama</option>
<option value="Papa">Papa</option>
<option value="Bintang">Bintang</option>
<option value="Bulan">Bulan</option>
<option value="Satria">Satria</option>
</select>
</div>

<!-- TANGGAL -->

<div class="mb-3">
<label class="fw-semibold">
<i class="fas fa-calendar-day"></i> Tanggal
</label>

<input
type="date"
class="form-control"
id="tanggal"
required
>
</div>



<!-- PUASA -->
<div class="card mb-3">
<div class="card-body">
<h6 class="fw-bold text-success">
<i class="fas fa-sun"></i> Puasa
</h6>
<div class="form-check">
<input class="form-check-input" id="puasa" type="checkbox">
Menjalankan Puasa
</div>
</div>
</div>

<!-- SHOLAT WAJIB -->
<div class="card mb-3">
<div class="card-body">
<h6 class="fw-bold text-primary">
<i class="fas fa-mosque"></i> Sholat Wajib
</h6>
<div class="form-check"><input id="subuh" class="form-check-input" type="checkbox"> Subuh</div>
<div class="form-check"><input id="zuhur" class="form-check-input" type="checkbox"> Zuhur</div>
<div class="form-check"><input id="asar" class="form-check-input" type="checkbox"> Asar</div>
<div class="form-check"><input id="magrib" class="form-check-input" type="checkbox"> Magrib</div>
<div class="form-check"><input id="isya" class="form-check-input" type="checkbox"> Isya</div>
<div class="form-check"><input id="tarawih" class="form-check-input" type="checkbox"> Tarawih</div>
</div>
</div>

<!-- SUNNAH -->
<div class="card mb-3">
<div class="card-body">
<h6 class="fw-bold text-warning">
<i class="fas fa-star"></i> Sholat Sunnah
</h6>
<div class="form-check"><input id="duha" class="form-check-input" type="checkbox"> Duha</div>
<div class="form-check"><input id="tahajud" class="form-check-input" type="checkbox"> Tahajud</div>
<div class="form-check"><input id="rawatib" class="form-check-input" type="checkbox"> Rawatib</div>
</div>
</div>

<!-- QURAN -->
<div class="card mb-4">
<div class="card-body">
<h6 class="fw-bold text-success">
<i class="fas fa-quran"></i> Al-Qur'an
</h6>
<div class="form-check">
<input id="quran" class="form-check-input" type="checkbox">
Membaca Al-Qur'an
</div>
</div>
</div>


<button id="btnSave" class="btn btn-save w-100" onclick="kirim()">
<i class="fas fa-save"></i> <span id="btnText">Simpan Amalan</span>
</button>

<hr class="my-4">

<h5 class="fw-bold text-center mb-3">
<i class="fas fa-chart-bar"></i> Dashboard Amalan
</h5>

<div class="table-responsive">
<table class="table table-bordered table-striped text-center" id="tabelDashboard">
<thead class="table-success">
<tr>
<th>Nama</th>
<th>Total Amalan</th>
           <th>Point (Rp)</th>
</tr>
</thead>
<tbody>
<!-- Data muncul di sini -->
</tbody>
</table>
</div>

</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwhx1CQguzTjOHTc6TmW0q1FoCQfOcxeKbZYaQPPRj9hWI13pEwtZdQx6RUMCbe3gNa/exec";

// Ambil nilai checkbox
function v(id){ 
return document.getElementById(id).checked ? 1 : 0;
}

// tanggal hari 

function setTanggalHariIni(){
const today = new Date().toISOString().split("T")[0];
document.getElementById("tanggal").value = today;
}


// ====================== KIRIM DATA ======================
function kirim(){

const btn = document.getElementById("btnSave");
const text = document.getElementById("btnText");

// Cegah klik dobel
btn.disabled = true;

// Loading
text.innerHTML = `
   <span class="spinner-border spinner-border-sm me-2"></span>
   Menyimpan...
 `;


if (tanggal.value === "") {
alert("⚠️ Tanggal wajib diisi!");
btn.disabled = false;
text.innerHTML = "Simpan Amalan";
return;
}



// Validasi nama
if(nama.value === ""){
alert("⚠️ Silakan pilih nama dulu!");
btn.disabled = false;
text.innerHTML = "Simpan Amalan";
return;
}

// Validasi tanggal
if(tanggal.value === ""){
alert("⚠️ Silakan pilih tanggal!");
btn.disabled = false;
text.innerHTML = "Simpan Amalan";
return;
}

const data = {
tanggal: document.getElementById("tanggal").value,
nama: nama.value,
puasa: v('puasa'),
subuh: v('subuh'),
zuhur: v('zuhur'),
asar: v('asar'),
magrib: v('magrib'),
isya: v('isya'),
tarawih: v('tarawih'),
duha: v('duha'),
tahajud: v('tahajud'),
rawatib: v('rawatib'),
quran: v('quran')
};



fetch(API_URL, {
method: "POST",
body: JSON.stringify(data)
})

.then(res => res.json())

.then(() => {

// Modal sukses
const modal = new bootstrap.Modal(
document.getElementById("modalSukses")
);
modal.show();

resetForm();

// Refresh dashboard
loadDashboard();

})

.catch(() => {
alert("❌ Gagal menyimpan data!");
})

.finally(() => {

// Aktifkan tombol lagi
btn.disabled = false;
text.innerHTML = "Simpan Amalan";

});

}


// ====================== RESET FORM ======================
function resetForm(){

document.querySelectorAll("input[type=checkbox]")
.forEach(el => el.checked = false);

nama.value = "";

}


// ====================== LOAD DASHBOARD ======================

function loadDashboard(){

fetch(API_URL + "?mode=dashboard")

.then(res => res.json())

.then(data => {

const tbody = document.querySelector("#tabelDashboard tbody");

tbody.innerHTML = "";

if(!data || data.length === 0){

tbody.innerHTML = `
       <tr>
          <td colspan="2" class="text-muted">
          <td colspan="3" class="text-muted">
           Belum ada data
         </td>
       </tr>
     `;
return;

}

data.forEach(row => {

      const tr = document.createElement("tr");
      const point = row.total * 2000;

      const tr = document.createElement("tr");
tr.innerHTML = `
       <td>${row.nama}</td>
       <td class="fw-bold text-success">
         ${row.total}
       </td>
        <td class="fw-bold text-primary">
          Rp ${point.toLocaleString("id-ID")}
        </td>
     `;

tbody.appendChild(tr);

});

})

.catch(err => {
console.log("Dashboard error:", err);
});

}



// ====================== AUTO LOAD SAAT BUKA ======================

document.addEventListener("DOMContentLoaded", function(){
setTanggalHariIni();   // set tanggal otomatis
loadDashboard();      // load dashboard
});


</script>


<!-- Modal Sukses -->
<div class="modal fade" id="modalSukses" tabindex="-1">
<div class="modal-dialog modal-dialog-centered">
<div class="modal-content rounded-4">

<div class="modal-header bg-success text-white">
<h5 class="modal-title">
<i class="fas fa-check-circle"></i> Berhasil
</h5>
<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
</div>

<div class="modal-body text-center py-4">
<i class="fas fa-check-circle fa-3x text-success mb-3"></i>
<h5>Data Berhasil Disimpan</h5>
<p class="text-muted mb-0">
Terima kasih, amalan sudah tercatat.
</p>
</div>

<div class="modal-footer justify-content-center">
<button class="btn btn-success px-4" data-bs-dismiss="modal">
OK
</button>
</div>

</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
